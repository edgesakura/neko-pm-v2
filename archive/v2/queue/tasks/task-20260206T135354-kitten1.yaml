task_id: "task-20260206T135354-kitten1"
assigned_to: "kitten1"
timestamp: "2026-02-06T13:53:54"
priority: high
load_skills: []
description: |
  【グループA: コード品質改善】改善提案 #1, #3 を実施せよ

  LINE Bot「イザカヤくん」のコード品質向上を目的とする2つのタスクにゃ。

  ## タスク1: #1 Secrets Manager のシークレット検証機能追加 [high]

  ### 目的
  エージェント起動時にSecrets Managerのキーが空でないか検証し、
  早期にエラーを検出する仕組みを追加するにゃ。

  ### 実装内容
  1. output/izakaya-agent/agent/tools/ 配下のツール定義を確認
  2. 各ツールでSecrets Managerから取得するキーをリストアップ
     - izakaya-agent/hotpepper-api-key
     - izakaya-agent/google-places-api-key
  3. エージェント起動時（agent/main.py または agent/agent.py）に検証ロジック追加:
     ```python
     def validate_secrets():
         """Secrets Manager のキーが設定されているか検証"""
         required_secrets = [
             "izakaya-agent/hotpepper-api-key",
             "izakaya-agent/google-places-api-key",
         ]
         for secret_name in required_secrets:
             value = get_secret(secret_name)
             if not value or value.strip() == "":
                 raise ValueError(f"Secret '{secret_name}' is not set. Please configure it in AWS Secrets Manager.")
     ```
  4. エージェント起動時に validate_secrets() を呼び出す
  5. テスト: 空のシークレットでエラーが出ることを確認

  ## タスク2: #3 Lambda と AgentCore の requirements.txt 統合 [high]

  ### 目的
  lambda/requirements.txt と agent/requirements.txt の依存関係の不一致を防ぐにゃ。
  今回の問題（Lambda Layer に strands-agents がない）は、この分離が原因だったにゃ。

  ### 実装内容
  1. 現状確認:
     - output/izakaya-agent/lambda/requirements.txt
     - output/izakaya-agent/agent/requirements.txt
     - 共通の依存パッケージをリストアップ
  2. 統合方針を決定（推奨: requirements-base.txt を作成）:
     ```
     output/izakaya-agent/
       ├── requirements-base.txt  # 共通依存（strands-agents等）
       ├── lambda/
       │   └── requirements.txt   # -r ../requirements-base.txt + Lambda固有
       └── agent/
           └── requirements.txt   # -r ../requirements-base.txt + Agent固有
     ```
  3. requirements-base.txt を作成:
     ```
     strands-agents>=0.1.0
     bedrock-agentcore-starter-toolkit>=0.1.0
     boto3>=1.26.0
     # その他共通依存
     ```
  4. lambda/requirements.txt を更新:
     ```
     -r ../requirements-base.txt
     # Lambda固有の依存（あれば）
     ```
  5. agent/requirements.txt を更新:
     ```
     -r ../requirements-base.txt
     # Agent固有の依存（あれば）
     ```
  6. 動作確認: Lambda Layer を再ビルドして依存が正しくインストールされるか確認

  ## 成果物
  - output/izakaya-agent/agent/main.py または agent/agent.py（検証ロジック追加）
  - output/izakaya-agent/requirements-base.txt（新規作成）
  - output/izakaya-agent/lambda/requirements.txt（更新）
  - output/izakaya-agent/agent/requirements.txt（更新）

context:
  references:
    - "output/izakaya-agent/agent/"
    - "output/izakaya-agent/lambda/requirements.txt"
    - "output/izakaya-agent/agent/requirements.txt"

expected_outputs:
  - "Secrets Manager 検証ロジックの実装"
  - "requirements.txt 統合の仕組み（requirements-base.txt）"
  - "動作確認結果"
