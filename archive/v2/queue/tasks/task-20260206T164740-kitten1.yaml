task_id: "task-20260206T164740-kitten1"
assigned_to: "kitten1"
timestamp: "2026-02-06T16:47:40"
priority: urgent
load_skills: []
description: |
  ğŸš¨ CORSä¿®æ­£ - API Gateway ã® allowOrigins ã« localhost:3002 è¿½åŠ 

  ## å•é¡Œ
  ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ãŒãƒãƒ¼ãƒˆ3002ã§èµ·å‹•ã—ã¦ã„ã‚‹ãŒã€API Gateway ã® CORSè¨­å®šã¯
  localhost:3001 ã®ã¿è¨±å¯ã—ã¦ã„ã‚‹ã€‚ã“ã®ã¾ã¾ã§ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰APIã‚’å‘¼ã¹ãªã„ã«ã‚ƒã€‚

  ## ä¿®æ­£å†…å®¹ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãƒ»1ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ï¼‰

  ### Step 1: izakaya-stack.ts ã® CORS è¨­å®šä¿®æ­£
  - ãƒ•ã‚¡ã‚¤ãƒ«: output/izakaya-agent/infra/lib/izakaya-stack.ts
  - allowOrigins ã« 'http://localhost:3002' ã‚’è¿½åŠ 
  - æ—¢å­˜ã® 'http://localhost:3001' ã‚‚æ®‹ã™ï¼ˆä¸¡æ–¹è¨±å¯ï¼‰

  **ä¿®æ­£ä¾‹**:
  ```typescript
  // Before
  allowOrigins: ['http://localhost:3001']

  // After
  allowOrigins: ['http://localhost:3001', 'http://localhost:3002']
  ```

  ### Step 2: CDK ãƒ‡ãƒ—ãƒ­ã‚¤
  ```bash
  cd output/izakaya-agent/infra
  npx cdk deploy --require-approval never
  ```

  ### Step 3: å‹•ä½œç¢ºèª
  - curl ã§ localhost:3002 ã‚ªãƒªã‚¸ãƒ³ã‹ã‚‰ã®ãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ç¢ºèª

  ```bash
  # ãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆOPTIONSï¼‰
  curl -X OPTIONS https://ok1y8ns08b.execute-api.ap-northeast-1.amazonaws.com/prod/chat \
    -H "Origin: http://localhost:3002" \
    -H "Access-Control-Request-Method: POST" \
    -v
  ```

  æœŸå¾…å€¤: `access-control-allow-origin: http://localhost:3002` ãŒè¿”ã‚‹ã“ã¨

  ## æ³¨æ„äº‹é …
  - æ—¢å­˜ã® 'http://localhost:3001' ã‚’å‰Šé™¤ã—ãªã„ã“ã¨ï¼ˆä¸¡æ–¹è¨±å¯ï¼‰
  - å…¨ã‚ªãƒªã‚¸ãƒ³è¨±å¯ï¼ˆ`*`ï¼‰ã«ã—ãªã„ã“ã¨ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ï¼‰
  - ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã¾ã§ç´„2-3åˆ†ã‹ã‹ã‚‹

context:
  service_name: "izakaya-agent"
  project_dir: "output/izakaya-agent"
  infra_dir: "output/izakaya-agent/infra"
  api_gateway: "https://ok1y8ns08b.execute-api.ap-northeast-1.amazonaws.com/prod/chat"
  references:
    - "output/izakaya-agent/infra/lib/izakaya-stack.ts"

expected_outputs:
  - "CORSè¨­å®šä¿®æ­£ï¼ˆallowOrigins ã« localhost:3002 è¿½åŠ ï¼‰"
  - "CDKãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸ"
  - "localhost:3002 ã‹ã‚‰ã®APIã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª"
