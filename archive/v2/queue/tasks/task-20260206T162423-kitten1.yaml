task_id: "task-20260206T162423-kitten1"
assigned_to: "kitten1"
timestamp: "2026-02-06T16:24:23"
priority: high
load_skills: []
description: |
  ğŸ”§ Cognito User Pool çµ±ä¸€ - Amplify Gen 2 å´ã«ä¸€æœ¬åŒ–

  ## èƒŒæ™¯
  Phase 1 ã§å­çŒ«1ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰ã¨å­çŒ«2ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰ãŒãã‚Œãã‚Œåˆ¥ã®
  Cognito User Pool ã‚’ä½œæˆã—ã¦ã—ã¾ã£ãŸã€‚èªè¨¼ã®ä¸€è²«æ€§ã®ãŸã‚çµ±ä¸€ãŒå¿…è¦ã«ã‚ƒã€‚

  ## ç¾çŠ¶
  | ä½œæˆè€… | User Pool ID | ç”¨é€” | å¯¾å¿œ |
  |--------|-------------|------|------|
  | å­çŒ«1ï¼ˆAmplify Gen 2ï¼‰ | ap-northeast-1_VwL7teKWl | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èªè¨¼ | âœ… **æ®‹ã™** |
  | å­çŒ«2ï¼ˆCDKï¼‰ | ap-northeast-1_7ctUrtWE6 | API Gateway Authorizer | âŒ **æ¶ˆã™** |

  ## ã‚¿ã‚¹ã‚¯

  ### Step 1: CDK ã‚¹ã‚¿ãƒƒã‚¯ä¿®æ­£ï¼ˆizakaya-stack.tsï¼‰
  - CDK ã§æ–°è¦ Cognito User Pool ã‚’ä½œæˆã—ã¦ã„ã‚‹ç®‡æ‰€ã‚’ç‰¹å®šãƒ»å‰Šé™¤
  - ä»£ã‚ã‚Šã« Amplify ã® User Pool ID (`ap-northeast-1_VwL7teKWl`) ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†å¤‰æ›´
  - `UserPool.fromUserPoolId()` ã§æ—¢å­˜ Pool ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
  - API Gateway Cognito Authorizer ãŒã“ã® Pool ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†æ›´æ–°
  - ãƒ•ã‚¡ã‚¤ãƒ«: output/izakaya-agent/infra/lib/izakaya-stack.ts

  **å®Ÿè£…ä¾‹**:
  ```typescript
  import * as cognito from 'aws-cdk-lib/aws-cognito';

  // æ—¢å­˜ã®Amplify User Poolã‚’å‚ç…§
  const userPool = cognito.UserPool.fromUserPoolId(
    this,
    'AmplifyUserPool',
    'ap-northeast-1_VwL7teKWl'
  );

  // API Gateway Cognito Authorizerã§ä½¿ç”¨
  const cognitoAuthorizer = new apigateway.CognitoUserPoolsAuthorizer(
    this,
    'CognitoAuthorizer',
    {
      cognitoUserPools: [userPool],
    }
  );
  ```

  ### Step 2: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­å®šç¢ºèª
  - output/nomibero-web/ ã® Amplify è¨­å®šãŒ `ap-northeast-1_VwL7teKWl` ã‚’å‚ç…§ã—ã¦ã„ã‚‹ã“ã¨ç¢ºèª
  - API Gateway ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«åŒã˜ Pool ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã†ã“ã¨ç¢ºèª
  - amplify/auth/resource.ts ã¨ amplify/backend.ts ã‚’ç¢ºèª

  ### Step 3: CDK ãƒ‡ãƒ—ãƒ­ã‚¤
  ```bash
  cd output/izakaya-agent/infra
  npx cdk deploy --require-approval never
  ```

  ### Step 4: ä¸è¦ãª User Pool å‰Šé™¤
  ```bash
  aws cognito-idp delete-user-pool --user-pool-id ap-northeast-1_7ctUrtWE6 --region ap-northeast-1
  ```

  ### Step 5: å‹•ä½œç¢ºèª
  - API Gateway ã« Cognito ãƒˆãƒ¼ã‚¯ãƒ³ä»˜ãã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ 200 ãŒè¿”ã‚‹ã“ã¨ç¢ºèª
  - ãƒˆãƒ¼ã‚¯ãƒ³ãªã—ã§ 401 ãŒè¿”ã‚‹ã“ã¨ç¢ºèª
  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚°ã‚¤ãƒ³â†’APIå‘¼ã³å‡ºã—ãŒé€šã‚‹ã“ã¨ç¢ºèª

  ## æ³¨æ„äº‹é …
  - ã¾ã ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã¯ã—ã¦ã„ãªã„ã®ã§ã€ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã¯ä¸è¦
  - Amplify Gen 2 ã® User Pool ã‚’æ­£ã¨ã™ã‚‹ï¼ˆAmplify ãŒç®¡ç†ã™ã‚‹ãŸã‚ï¼‰
  - CDK å´ã¯æ—¢å­˜ Pool ã®å‚ç…§ã®ã¿ï¼ˆä½œæˆã—ãªã„ï¼‰
  - **çµ¶å¯¾ã« ap-northeast-1_VwL7teKWl ã‚’å‰Šé™¤ã—ãªã„ã“ã¨ï¼**ï¼ˆKeep ã™ã‚‹ Poolï¼‰

context:
  service_name: "izakaya-agent"
  project_dir: "output/izakaya-agent"
  frontend_dir: "output/nomibero-web"
  region: "ap-northeast-1"
  keep_pool_id: "ap-northeast-1_VwL7teKWl"
  delete_pool_id: "ap-northeast-1_7ctUrtWE6"
  references:
    - "output/izakaya-agent/infra/lib/izakaya-stack.ts"
    - "output/nomibero-web/amplify/auth/resource.ts"
    - "output/nomibero-web/amplify/backend.ts"

expected_outputs:
  - "CDKã‚¹ã‚¿ãƒƒã‚¯ä¿®æ­£ï¼ˆAmplify Poolå‚ç…§ï¼‰"
  - "CDKãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸ"
  - "ä¸è¦User Poolå‰Šé™¤ï¼ˆap-northeast-1_7ctUrtWE6ï¼‰"
  - "API Gatewayèªè¨¼ãƒ†ã‚¹ãƒˆæˆåŠŸ"
  - "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰â†’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èªè¨¼ãƒ•ãƒ­ãƒ¼å‹•ä½œç¢ºèª"
