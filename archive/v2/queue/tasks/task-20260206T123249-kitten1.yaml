task_id: "task-20260206T123249-kitten1"
assigned_to: "kitten1"
timestamp: "2026-02-06T12:32:49"
priority: high
parent_command_id: "cmd-20260206T122832"
description: |
  ã€ğŸ”ğŸ”§ LINE Bot æ¥ç¶šã‚¨ãƒ©ãƒ¼ + ãƒ›ãƒƒãƒˆãƒšãƒƒãƒ‘ãƒ¼APIèª¿æŸ»ãƒ»ä¿®æ­£ã€‘
  LINE BotçµŒç”±ã§ã‚¨ãƒ©ãƒ¼ãŒè¿”ã‚‹å•é¡Œã‚’èª¿æŸ»ãƒ»ä¿®æ­£ã›ã‚ˆã€‚

  ## çŠ¶æ³
  - å‰å›ä¿®æ­£: Lambda Layerã®ãƒã‚¤ãƒŠãƒªMBäº’æ›æ€§å•é¡Œ â†’ manylinux wheelã§ä¿®æ­£æ¸ˆã¿
  - Lambdaæ­£å¸¸èµ·å‹•ç¢ºèªæ¸ˆã¿ã€ç½²åæ¤œè¨¼ã¾ã§åˆ°é”
  - **ä»Šå›**: LINE BotçµŒç”±ã ã¨ã¾ã ã‚¨ãƒ©ãƒ¼ãŒè¿”ã‚‹
  - 2ã¤ã®å•é¡Œã®å¯èƒ½æ€§:
    1. ã‚·ã‚¹ãƒ†ãƒ æ¥ç¶šã‚¨ãƒ©ãƒ¼ï¼ˆLINE â†’ Lambda â†’ AgentCore ã®çµŒè·¯ï¼‰
    2. ãƒ›ãƒƒãƒˆãƒšãƒƒãƒ‘ãƒ¼APIã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè¨­å®šãƒŸã‚¹

  ## èª¿æŸ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆä¸Šã‹ã‚‰é †ã«å®Ÿæ–½ï¼‰

  ### Step 1: CloudWatch Logs ã§æœ€æ–°ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèªï¼ˆæœ€å„ªå…ˆï¼‰
  LINEã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã£ãŸæ™‚ã®æœ€æ–°ãƒ­ã‚°ã‚’è¦‹ã‚‹
  ```bash
  # Lambdaé–¢æ•°åã®ç‰¹å®š
  aws cloudformation describe-stack-resources --stack-name IzakayaStack --region ap-northeast-1 \
    --query "StackResources[?ResourceType=='AWS::Lambda::Function'].PhysicalResourceId" --output text
  # æœ€æ–°ãƒ­ã‚°ç¢ºèªï¼ˆç›´è¿‘30åˆ†ï¼‰
  aws logs filter-log-events --log-group-name /aws/lambda/<é–¢æ•°å> \
    --start-time $(date -d '30 minutes ago' +%s)000 --region ap-northeast-1 --limit 50
  ```

  ### Step 2: handler.py ã®æ¥ç¶šãƒ•ãƒ­ãƒ¼ç¢ºèª
  LINE â†’ Lambda â†’ AgentCore Runtime ã®æ¥ç¶šã‚³ãƒ¼ãƒ‰ã‚’ç²¾æŸ»
  - SigV4èªè¨¼ã®å®Ÿè£…ç¢ºèª
  - AgentCore Runtime APIå‘¼ã³å‡ºã—éƒ¨åˆ†ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‘ãƒ¼ã‚¹ãƒ»LINEè¿”ä¿¡å‡¦ç†
  ãƒ•ã‚¡ã‚¤ãƒ«: output/izakaya-agent/lambda/handler.py

  ### Step 3: ãƒ›ãƒƒãƒˆãƒšãƒƒãƒ‘ãƒ¼APIã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç¢ºèª
  - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©ã§ãƒ›ãƒƒãƒˆãƒšãƒƒãƒ‘ãƒ¼APIã‚­ãƒ¼ã‚’ã©ã†å‚ç…§ã—ã¦ã„ã‚‹ã‹ç¢ºèª
  - Lambdaç’°å¢ƒå¤‰æ•°ã« HOTPEPPER_API_KEY ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
  - AgentCoreã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®šã«APIã‚­ãƒ¼ãŒæ¸¡ã•ã‚Œã¦ã„ã‚‹ã‹
  ```bash
  # Lambdaç’°å¢ƒå¤‰æ•°ã®å…¨é‡ç¢ºèª
  aws lambda get-function-configuration --function-name <é–¢æ•°å> \
    --region ap-northeast-1 --query "Environment.Variables"
  # AgentCoreã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
  cat output/izakaya-agent/agent/agent.py
  cat output/izakaya-agent/agent/tools.py  # ãƒ„ãƒ¼ãƒ«å®šç¾©
  ```

  ### Step 4: Lambdaç›´æ¥invokeãƒ†ã‚¹ãƒˆï¼ˆæ¥ç¶šç¢ºèªï¼‰
  ```bash
  aws lambda invoke --function-name <é–¢æ•°å> \
    --payload '{"body": "{\"events\":[{\"type\":\"message\",\"message\":{\"type\":\"text\",\"text\":\"æ¸‹è°·ã§ãŠã™ã™ã‚ã®å±…é…’å±‹æ•™ãˆã¦\"},\"source\":{\"userId\":\"test123\"},\"replyToken\":\"test-token\"}]}"}' \
    --region ap-northeast-1 --log-type Tail /tmp/lambda-response.json
  cat /tmp/lambda-response.json
  ```

  ### Step 5: å•é¡Œã®ä¿®æ­£
  - æ¥ç¶šã‚¨ãƒ©ãƒ¼ â†’ handler.pyã®APIå‘¼ã³å‡ºã—ä¿®æ­£
  - ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå•é¡Œ â†’ ç’°å¢ƒå¤‰æ•°è¿½åŠ  or ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®šä¿®æ­£
  - ä¿®æ­£å¾Œ â†’ cdk deploy ã§å†ãƒ‡ãƒ—ãƒ­ã‚¤

context:
  service_name: "izakaya-agent"
  project_dir: "output/izakaya-agent"
  handler_path: "output/izakaya-agent/lambda/handler.py"
  runtime_arn: "arn:aws:bedrock-agentcore:ap-northeast-1:921563379197:runtime/izakaya_agent-9JGtN3Enat"
  region: "ap-northeast-1"
  references:
    - "output/izakaya-agent/lambda/handler.py"
    - "output/izakaya-agent/agent/"
    - "output/izakaya-agent/cdk/"

expected_outputs:
  - "CloudWatch Logsã®ã‚¨ãƒ©ãƒ¼å†…å®¹ãƒ¬ãƒãƒ¼ãƒˆï¼ˆnawabari.mdå½¢å¼ï¼‰"
  - "æ¥ç¶šã‚¨ãƒ©ãƒ¼ã®åŸå› ã¨ä¿®æ­£"
  - "ãƒ›ãƒƒãƒˆãƒšãƒƒãƒ‘ãƒ¼APIã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®è¨­å®šçŠ¶æ³ã¨ä¿®æ­£"
  - "ä¿®æ­£å¾Œã®å‹•ä½œç¢ºèªçµæœ"
  - "skill_candidate ã®è©•ä¾¡ï¼ˆå¿…é ˆï¼‰"

note: |
  - Step 1ã‹ã‚‰é †ã«å®Ÿæ–½ã›ã‚ˆ
  - å„Stepã®çµæœã‚’å ±å‘Šã«å«ã‚ã‚‹ã“ã¨
  - ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’è©³ç´°ã«ç¢ºèªã—ã€æ ¹æœ¬åŸå› ã‚’ç‰¹å®šã™ã‚‹ã“ã¨
  - ä¿®æ­£å¾Œã¯å¿…ãšå‹•ä½œç¢ºèªã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨
  - å‰å›ã®ä¿®æ­£ï¼ˆLambda Layerï¼‰ã¨ã®é•ã„ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨
