task_id: "task-20260202-135133-kitten2"
assigned_to: "kitten2"
timestamp: "2026-02-02T13:51:33"
priority: high
command_id: "cmd-20260202-133649"
description: |
  【タスク】chat-app Moshi化 - フロントエンド（xterm.js + UI構築）

  ## 目的
  chat-appをMoshi的なターミナル体験に改修するにゃ（フロントエンド担当）。
  xterm.jsを導入して、本物のターミナルUIを実装するにゃ。

  ## 実装内容

  ### フェーズ1: xterm.js基盤構築

  #### 1-1. package.json に依存関係追加
  **ファイル**: /home/edgesakura/git/neko-pm/output/chat-app/package.json

  以下を追加（まだインストールはしない、子猫3がバックエンド対応後に一括インストール）：
  ```json
  "dependencies": {
    ...existing,
    "xterm": "^5.3.0",
    "xterm-addon-fit": "^0.8.0",
    "xterm-addon-web-links": "^0.9.0"
  }
  ```

  #### 1-2. index.html にターミナルコンテナ追加
  **ファイル**: /home/edgesakura/git/neko-pm/output/chat-app/public/index.html

  現在のチャットUIをターミナルUIに置き換え：
  - 既存の `#chat-container` をコメントアウト（バックアップ）
  - 新しい `#terminal-container` を追加
  - xterm.js のCSS/JSをCDN経由で読み込み（npm install前の動作確認用）

  ```html
  <!-- 既存のチャットUI（バックアップ） -->
  <!-- <div id="chat-container">...</div> -->

  <!-- 新しいターミナルUI -->
  <div id="terminal-container"></div>

  <!-- xterm.js（CDN） -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
  <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.js"></script>

  <!-- ターミナルロジック -->
  <script src="/terminal.js"></script>
  ```

  #### 1-3. terminal.js 作成（新規ファイル）
  **ファイル**: /home/edgesakura/git/neko-pm/output/chat-app/public/terminal.js

  基本的なターミナル表示を実装：
  ```javascript
  // xterm.js インスタンス作成
  const term = new Terminal({
    cursorBlink: true,
    fontSize: 14,
    fontFamily: 'Menlo, Monaco, "Courier New", monospace',
    theme: {
      background: '#1e1e1e',
      foreground: '#d4d4d4'
    }
  });

  // FitAddon（画面サイズに合わせる）
  const fitAddon = new FitAddon.FitAddon();
  term.loadAddon(fitAddon);

  // WebLinksAddon（URLクリック可能に）
  const webLinksAddon = new WebLinksAddon.WebLinksAddon();
  term.loadAddon(webLinksAddon);

  // DOMにマウント
  term.open(document.getElementById('terminal-container'));
  fitAddon.fit();

  // リサイズ対応
  window.addEventListener('resize', () => {
    fitAddon.fit();
  });

  // WebSocket接続（子猫3のバックエンド実装を待つ）
  const ws = new WebSocket('ws://localhost:3000');

  ws.onopen = () => {
    term.writeln('Connected to neko:boss terminal');
  };

  ws.onmessage = (event) => {
    term.write(event.data);
  };

  ws.onclose = () => {
    term.writeln('\r\nConnection closed');
  };

  // キー入力をWebSocket経由で送信
  term.onData((data) => {
    if (ws.readyState === WebSocket.OPEN) {
      ws.send(data);
    }
  });
  ```

  ### フェーズ2: UI調整

  #### 2-1. styles.css 調整
  **ファイル**: /home/edgesakura/git/neko-pm/output/chat-app/public/styles.css

  ターミナルコンテナのスタイル追加：
  ```css
  #terminal-container {
    width: 100%;
    height: calc(100vh - 60px); /* ヘッダー分を引く */
    padding: 10px;
    background: #1e1e1e;
  }

  /* モバイル最適化 */
  @media (max-width: 768px) {
    #terminal-container {
      height: calc(100vh - 50px);
      padding: 5px;
    }
  }
  ```

  #### 2-2. 接続状態インジケーター追加
  index.html に接続状態表示を追加：
  ```html
  <div id="connection-status">
    <span class="status-dot" id="status-indicator"></span>
    <span id="status-text">Connecting...</span>
  </div>
  ```

  styles.css にスタイル追加：
  ```css
  #connection-status {
    position: fixed;
    top: 10px;
    right: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: rgba(0, 0, 0, 0.8);
    border-radius: 20px;
  }

  .status-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }

  .status-dot.connected { background: #4caf50; }
  .status-dot.connecting { background: #ff9800; }
  .status-dot.disconnected { background: #f44336; }
  ```

  ### 既存機能の維持
  - Alertsタブは別タブとして維持（index.html のタブ切り替え機能を残す）
  - 認証機能は維持（既存のauth.js等）

  ## 動作確認

  実装後、以下を確認：
  1. xterm.js がCDN経由で正しく読み込まれること
  2. terminal.js で基本的なターミナル表示ができること
  3. 接続状態インジケーターが表示されること
  4. モバイルでレイアウトが崩れないこと

  ※ WebSocket実装は子猫3のバックエンド実装待ち

context:
  chat_app_location: "/home/edgesakura/git/neko-pm/output/chat-app/"
  target_files:
    - "public/index.html"
    - "public/terminal.js"
    - "public/styles.css"
    - "package.json"
  references:
    - "https://xtermjs.org/"

expected_outputs:
  - "public/index.html（xterm.js対応版）"
  - "public/terminal.js（新規作成）"
  - "public/styles.css（ターミナルスタイル追加）"
  - "package.json（依存関係追加）"
  - "完了報告（queue/reports/ にYAML作成）"

notes: |
  - xterm.js はまずCDN経由で動作確認するにゃ
  - npm install は子猫3のバックエンド実装後に一括で実行するにゃ
  - 既存のチャットUIはコメントアウトしてバックアップ保持にゃ
  - Alertsタブは維持するにゃ
  - 完了したら queue/reports/ に報告YAML作成にゃ
