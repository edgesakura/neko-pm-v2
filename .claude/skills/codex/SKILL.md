---
name: codex
description: OpenAI Codex CLIを使用したコードレビュー・分析。コードレビュー、バグ調査、リファクタリング提案、アーキテクチャ分析に使用
allowed-tools: Bash
---

# Codex

OpenAI Codex CLIを使用してコードレビュー・分析を実行するスキル。

## トリガー

"codex", "コードレビュー", "レビューして", "分析して", "/codex"

## コマンド使い分け

Codex CLIは用途に応じて2つのコマンドを使い分ける。

### codex exec（深掘り調査・詳細分析）

プロジェクト全体を対象とした深い調査や分析に使用。

```bash
codex exec --full-auto --sandbox read-only --cd <project_directory> "<request>"
```

**用途:**
- プロジェクト全体のアーキテクチャ分析
- 複雑なバグの原因調査
- 技術選択のトレードオフ分析
- リファクタリング提案
- パフォーマンスボトルネック調査

**パラメータ:**

| パラメータ | 説明 |
|-----------|------|
| `--full-auto` | 完全自動モードで実行 |
| `--sandbox read-only` | 読み取り専用サンドボックス（安全な分析用） |
| `--cd <dir>` | 対象プロジェクトのディレクトリ |
| `"<request>"` | 依頼内容（日本語可） |

### codex review（コードレビュー）

git差分をベースとしたコードレビューに特化。

```bash
# コミット前の変更をレビュー
codex review --uncommitted

# 特定のブランチとの差分をレビュー
codex review --base main

# 特定のコミットをレビュー
codex review --commit abc123

# カスタムレビュー指示
codex review --uncommitted "セキュリティ脆弱性を重点的にチェック"
```

**用途:**
- PR作成前のコードレビュー
- コミット前の変更チェック
- セキュリティ脆弱性の検出
- コーディング規約違反の検出
- パフォーマンス問題の表面的チェック

**主要オプション:**

| オプション | 説明 |
|-----------|------|
| `--uncommitted` | staged, unstaged, untracked の変更をレビュー |
| `--base <BRANCH>` | 指定ブランチとの差分をレビュー |
| `--commit <SHA>` | 特定のコミットをレビュー |
| `--title <TITLE>` | レビューサマリーに表示するタイトル |

### コマンド選択フロー

```
タスクを受信
    ↓
git差分ベースのレビュー？
    ├─ YES → codex review（高速）
    └─ NO → プロジェクト全体の調査？
            ├─ YES → codex exec（深掘り）
            └─ NO → 自分で実施
```

## 使用例

### 差分ベースのコードレビュー（codex review）

```bash
# PR作成前の変更をレビュー
codex review --uncommitted

# mainブランチとの差分をセキュリティ重視でレビュー
codex review --base main "セキュリティ脆弱性を重点的にチェック"

# 特定のコミットをレビュー
codex review --commit abc123
```

### プロジェクト全体のレビュー（codex exec）

```bash
codex exec --full-auto --sandbox read-only --cd /path/to/project "このプロジェクトのコードをレビューして、改善点を指摘してください"
```

### バグ調査（codex exec）

```bash
codex exec --full-auto --sandbox read-only --cd /path/to/project "認証処理でエラーが発生する原因を調査してください"
```

### リファクタリング提案（codex exec）

```bash
codex exec --full-auto --sandbox read-only --cd /path/to/project "このコードのリファクタリング案を提示してください"
```

### アーキテクチャ分析（codex exec）

```bash
codex exec --full-auto --sandbox read-only --cd /path/to/project "プロジェクト全体のアーキテクチャを分析してください"
```

## 実行手順

1. ユーザーから依頼内容を受け取る
2. 対象プロジェクトのディレクトリを特定（デフォルト: カレントディレクトリ）
3. 上記コマンド形式でCodexを実行
4. 結果をユーザーに報告

## 使用場面

- コードレビュー依頼時
- コードベース全体の分析
- 実装に関する質問
- バグの調査
- リファクタリング提案
- 解消が難しい問題の調査

## モデル選択

Codex CLIは複数のモデルをサポート。タスクに応じて最適なモデルを選択。

### 利用可能なモデル

| モデル | 特徴 | 用途 | コスト |
|--------|------|------|--------|
| **codex-mini-latest** (o4-mini) | 高速・軽量 | コードレビュー、セキュリティ監査 | 低 |
| **gpt-5.2-codex** (GPT-5.2-thinking) | 深い推論 | 詳細分析、複雑な調査、技術判断 | 高 |

### モデル指定方法

```bash
# -m オプションで指定
codex exec -m gpt-5.2-codex --full-auto --sandbox read-only --cd <dir> "<request>"

# -c オプションで指定（config override）
codex exec -c model="gpt-5.2-codex" --full-auto --sandbox read-only --cd <dir> "<request>"
```

## 使い分け基準

### 目利きフクロウ（コードレビュー）vs 研究狸（深掘り調査）

| 項目 | 目利きフクロウ | 研究狸 |
|------|-------------|--------|
| **モデル** | codex-mini-latest (o4-mini) | gpt-5.2-codex |
| **速度** | 高速（数秒〜数分） | 低速（5〜30分） |
| **深さ** | 表面的なレビュー | 深い分析・推論 |
| **コスト** | 低コスト | 高コスト |
| **使用場面** | 定型的なコードレビュー<br>セキュリティチェック<br>スタイル違反検出 | 複雑なバグ調査<br>アーキテクチャ分析<br>技術判断が必要な調査 |

### 判断フロー

```
タスクを受信
    ↓
定型的なコードレビュー？
    ├─ YES → 目利きフクロウ（codex-mini-latest）
    └─ NO → 複雑な調査や判断が必要？
            ├─ YES → 研究狸（gpt-5.2-codex）
            └─ NO → 自分で実施
```

### 目利きフクロウを使うべき場合

- ✅ 変更ファイルの一般的なコードレビュー
- ✅ セキュリティ脆弱性の検出（OWASP Top 10）
- ✅ コーディング規約違反の検出
- ✅ パフォーマンス問題の表面的チェック
- ✅ テストカバレッジの確認

### 研究狸を使うべき場合

- ✅ 原因不明のバグの深掘り調査
- ✅ アーキテクチャ全体の分析
- ✅ 複数の技術選択肢のトレードオフ分析
- ✅ ボスねこが技術判断に迷った時の相談
- ✅ パフォーマンスボトルネックの詳細分析
- ✅ セキュリティリスクの影響範囲調査

## 深掘り調査（研究狸）

複雑な問題や技術判断が必要な場合、研究狸（gpt-5.2-codex）を使用。

### 実行コマンド

```bash
codex exec -m gpt-5.2-codex --full-auto --sandbox read-only --cd <project_directory> "<request>"
```

### 調査テンプレート

#### バグ調査テンプレート

```bash
codex exec -m gpt-5.2-codex --full-auto --sandbox read-only --cd /path/to/project "
【バグ深掘り調査】

## 現象
{具体的な症状}

## 仮説
以下の仮説を独立して検証せよ：
1. {仮説A}
2. {仮説B}
3. {仮説C}

## 調査手順
1. 各仮説を独立して検証
2. ログ・スタックトレースの詳細分析
3. 関連コードの依存関係分析
4. 最も可能性の高い原因の特定
5. 修正案の提示（複数案）

## 出力形式
- 検証結果サマリー
- 原因の特定
- 修正案（優先度付き）
"
```

#### アーキテクチャ分析テンプレート

```bash
codex exec -m gpt-5.2-codex --full-auto --sandbox read-only --cd /path/to/project "
【アーキテクチャ分析】

## 対象
{システム名・コンポーネント名}

## 分析項目
1. 現在の設計の評価
2. スケーラビリティの評価
3. 保守性の評価
4. セキュリティリスクの評価
5. 改善提案（短期・長期）

## 出力形式
- 現状の構造図（テキスト）
- 各評価項目のスコア（5段階）
- 改善提案（優先度・難易度・効果）
"
```

#### 技術選択トレードオフ分析テンプレート

```bash
codex exec -m gpt-5.2-codex --full-auto --sandbox read-only --cd /path/to/project "
【技術選択トレードオフ分析】

## 選択肢
- 案A: {技術スタックA}
- 案B: {技術スタックB}
- 案C: {技術スタックC}

## 評価軸
1. 開発速度
2. 運用コスト
3. スケーラビリティ
4. 学習コスト
5. コミュニティサポート
6. 長期保守性

## 出力形式
- 各案の評価（5段階スコア）
- メリット・デメリット表
- 推奨案とその理由
- リスクとミティゲーション
"
```

### 調査レポート形式

研究狸の調査結果は以下の形式で返される：

```markdown
# 調査レポート

## エグゼクティブサマリー
{結論を1段落で}

## 調査結果詳細
### 仮説A: {タイトル}
- 検証結果: {結果}
- 根拠: {根拠}

### 仮説B: {タイトル}
...

## 結論
{最も可能性の高い原因・推奨案}

## アクションアイテム
1. {次のステップ1}
2. {次のステップ2}
```
